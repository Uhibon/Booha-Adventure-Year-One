<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Overworld – Year One</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1530;        /* deep navy */
  --ink:#eef2ff;       /* text */
  --muted:#93a3c2;     /* slate */
  --gold:#ffd400;      /* booha yellow core */
  --gold-soft:#fff87a; /* soft highlight */
  --aqua:#65e7ff;      /* visited glow */
  --locked:#223055;    /* locked nodes */
  --radius:22px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", Helvetica, Arial; background:var(--bg); color:var(--ink);}

.header{padding:18px 14px 8px;text-align:center}
.header h1{font-family:Cinzel,serif;font-weight:900;letter-spacing:.4px;font-size:clamp(22px,3.6vw,34px)}
.header p{color:var(--muted);font-size:clamp(12px,2.4vw,14px)}

/* ---- Map Canvas ---- */
#map{position:relative; height:calc(100dvh - 140px); max-width:1100px; margin:6px auto 0; border:1px solid #ffffff14; border-radius:20px; overflow:hidden;
  background:radial-gradient(2000px 800px at 50% 0%, #0f1b3e 0%, #0b1530 40%, #0a1227 100%);} 

/* Month labels */
.month-label{position:absolute; color:#c7d2fe; font-size:12px; opacity:.8; pointer-events:none; font-family:Cinzel,serif}

/* Week nodes (shimmering circles) */
.node{position:absolute; width:28px; height:28px; border-radius:50%;
  background: radial-gradient(circle at 40% 35%, #ffe66d, #ffd400 60%, #d4a900 100%);
  box-shadow: 0 0 0 2px #00000050 inset, 0 0 10px #ffd40080, 0 0 26px #ffd40040; 
  animation:pulse 2.2s ease-in-out infinite; cursor:pointer; outline:none; border:none}
.node.locked{background: radial-gradient(circle at 40% 35%, #3a476e, #26345a 60%, #1c2746 100%); box-shadow:0 0 0 2px #00000060 inset}
.node.visited{background: radial-gradient(circle at 40% 35%, #bff7ff, #65e7ff 62%, #2bd0ff 100%); box-shadow:0 0 0 2px #00141e inset, 0 0 18px #65e7ffaa, 0 0 34px #2bd0ff55}
@keyframes pulse{0%,100%{filter:brightness(1)} 50%{filter:brightness(1.18)}}

/* Path hint (subtle line) */
.path{position:absolute; left:0; top:0; right:0; bottom:0; pointer-events:none}
.path svg{width:100%;height:100%;opacity:.14}

/* ---- Top-down Booha ---- */
#booha{position:absolute; width:32px; height:32px; border-radius:50%; z-index:10; pointer-events:none;
  background:radial-gradient(circle at 35% 35%, #fffef0 0%, #fff87a 40%, #ffd400 78%, #ffb300 100%);
  box-shadow: 0 0 10px #ffd400aa, 0 8px 24px #00000080; transform:translate(-50%,-50%)}
/* hover shadow ring */
#shadow{position:absolute; width:38px; height:10px; background:radial-gradient(ellipse at center, #00000070 0%, transparent 70%);
  transform:translate(-50%,-50%); filter:blur(2px); opacity:.6; pointer-events:none; z-index:5}

/* floating idle bob for life */
.idle{animation:idle 3s ease-in-out infinite}
@keyframes idle{0%,100%{transform:translate(-50%,-50%) translateY(0)} 50%{transform:translate(-50%,-50%) translateY(-4px)}}

/* Sparkly trail */
.spark{position:absolute;width:6px;height:6px;border-radius:50%;pointer-events:none;
  background:radial-gradient(circle at 35% 35%, #fff, #ffe66d 55%, transparent 70%);
  box-shadow:0 0 10px #ffd400c0; animation:spark .7s ease-out forwards}
@keyframes spark{0%{transform:scale(.9);opacity:1}60%{transform:scale(1.1)}100%{transform:scale(.2) translateY(6px);opacity:0}}

/* Footer */
.footer{padding:10px 12px; text-align:center; color:#9fb0d5; font-size:12px}
.footer a{color:#cfe0ff}

/* Modal (week decks) */
.modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:50}
.modal.show{display:flex}
.modal .backdrop{position:absolute; inset:0; background:#0008}
.modal .card{position:relative; width:min(680px,92vw); border-radius:18px; border:1px solid #ffffff22; padding:16px; background:linear-gradient(180deg,#101d42,#0b1530);
  box-shadow:0 20px 50px #000a}
.modal h2{font-family:Cinzel,serif; font-size:18px}
.modal p{color:#c7d2fe; margin:6px 0 12px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.btn{flex:1; text-align:center; padding:10px 12px; border-radius:14px; border:1px solid #ffffff26; background:#101a39; color:#e2e8f0; text-decoration:none; font-size:14px}
.btn:hover{background:#122045}
.btn.primary{border-color:#ffe06644; background:linear-gradient(180deg,#1a2550,#122045)}
.close{position:absolute; right:10px; top:10px; border:none; background:transparent; color:#cbd5e1; font-size:20px; cursor:pointer}

/* Legend */
.legend{position:absolute; right:10px; top:10px; display:flex; gap:10px; align-items:center; background:#0b153080; padding:8px 10px; border-radius:12px; border:1px solid #ffffff1f}
.legend i{display:inline-block; width:14px; height:14px; border-radius:50%}
.legend .c1{background:radial-gradient(circle,#ffd400,#d4a900)}
.legend .c2{background:radial-gradient(circle,#65e7ff,#2bd0ff)}
.legend .c3{background:radial-gradient(circle,#3a476e,#1c2746)}
.legend span{color:#cfe0ff; font-size:12px}

</style>
</head>
<body>
  <header class="header">
    <h1>Booha Overworld: Year One</h1>
    <p>Top-down map from January to December. Guide Booha to each shimmering circle. When he arrives, open this week’s decks.</p>
  </header>

  <section id="map">
    <div class="legend">
      <i class="c1"></i><span>Next</span>
      <i class="c2"></i><span>Completed</span>
      <i class="c3"></i><span>Locked</span>
    </div>
    <!-- subtle SVG path (decorative) -->
    <div class="path" aria-hidden="true">
      <svg viewBox="0 0 100 100" preserveAspectRatio="none">
        <path d="M5 10 H95 V20 H5 V30 H95 V40 H5 V50 H95 V60 H5 V70 H95 V80 H5 V90 H95" stroke="#7dd3fc" stroke-width=".8" fill="none" stroke-linecap="round" stroke-dasharray="2 3"/>
      </svg>
    </div>
  </section>

  <div class="footer">Bryan's English School — Boo‑riculum Adventure • <a href="#" id="reset">reset progress</a></div>

  <!-- Booha & shadow -->
  <div id="shadow" class="idle"></div>
  <div id="booha" class="idle" aria-hidden="true"></div>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="backdrop" id="backdrop"></div>
    <div class="card">
      <button class="close" id="close">×</button>
      <h2 id="title">Month — Week</h2>
      <p id="desc">Choose a deck to open. You can change these URLs later.</p>
      <div class="row">
        <a class="btn primary" id="deck1" href="#">Deck 1 (placeholder)</a>
        <a class="btn" id="deck2" href="#">Deck 2 (placeholder)</a>
      </div>
    </div>
  </div>

<script>
// --------------------------------------
// CONFIG
// --------------------------------------
const MONTHS = [
  'January','February','March','April','May','June','July','August','September','October','November','December'
];

// 12 months × 4 weeks = 48 nodes in a zigzag rows layout
// We compute positions in percentages for responsiveness.
const ROWS = 12, COLS = 4;
// padding around edges
const PAD_X = 6, PAD_Y = 6; // percent

// State
const LS_INDEX = 'booha_overworld_current_index_v1';
const LS_VISITED = 'booha_overworld_visited_v1';
let currentIndex = parseInt(localStorage.getItem(LS_INDEX) || '0', 10);
let visited = JSON.parse(localStorage.getItem(LS_VISITED) || '[]');

// Elements
const map = document.getElementById('map');
const booha = document.getElementById('booha');
const shadow = document.getElementById('shadow');
const modal = document.getElementById('modal');
const backdrop = document.getElementById('backdrop');
const closeBtn = document.getElementById('close');
const titleEl = document.getElementById('title');
const deck1 = document.getElementById('deck1');
const deck2 = document.getElementById('deck2');

// Build coordinates and nodes
const nodes = []; // {i, monthIdx, weekIdx, x%, y%, el}
(function buildNodes(){
  const mapRect = map.getBoundingClientRect();
  for(let r=0; r<ROWS; r++){
    const y = PAD_Y + ( (100 - PAD_Y*2) * (r + 0.5) / ROWS );
    const snake = r % 2 === 1; // reverse every other row
    for(let c=0; c<COLS; c++){
      const t = snake ? (COLS - 1 - c) : c;
      const x = PAD_X + ( (100 - PAD_X*2) * (t + 0.5) / COLS );
      const i = r*COLS + c;
      const monthIdx = r;
      const weekIdx = c + 1;
      const el = document.createElement('button');
      el.className = 'node';
      el.style.left = x + '%';
      el.style.top  = y + '%';
      el.title = `${MONTHS[monthIdx]} — Week ${weekIdx}`;
      el.dataset.index = i;
      el.dataset.month = monthIdx;
      el.dataset.week = weekIdx;
      map.appendChild(el);
      nodes.push({i, monthIdx, weekIdx, x, y, el});

      // month labels at first node of visual left side each row
      if(c===0){
        const ml = document.createElement('div');
        ml.className = 'month-label';
        ml.textContent = MONTHS[monthIdx];
        // place label near left-most visual circle (consider snake)
        const lx = snake ? (PAD_X + ( (100 - PAD_X*2) * (COLS - 0.9) / COLS )) : (PAD_X + ( (100 - PAD_X*2) * (0.1) / COLS ));
        ml.style.left = lx + '%';
        ml.style.top  = (y - 5) + '%';
        map.appendChild(ml);
      }
    }
  }
})();

function refreshNodeStates(){
  nodes.forEach(n=>{
    n.el.classList.remove('locked','visited');
    if(visited.includes(n.i)){
      n.el.classList.add('visited');
      n.el.disabled = false;
    } else if(n.i === currentIndex){
      // next playable
      n.el.disabled = false;
    } else if(n.i < currentIndex){
      n.el.classList.add('visited');
      n.el.disabled = false;
    } else {
      n.el.classList.add('locked');
      n.el.disabled = true;
    }
  });
}

function placeBoohaAtIndex(i){
  const n = nodes[i] || nodes[0];
  positionBooha(n.x, n.y, false);
}

function positionBooha(xPercent, yPercent, trail=true){
  const mapRect = map.getBoundingClientRect();
  const x = mapRect.left + (xPercent/100)*mapRect.width + window.scrollX;
  const y = mapRect.top  + (yPercent/100)*mapRect.height + window.scrollY;

  const br = booha.getBoundingClientRect();
  const sx = br.left + br.width/2 + window.scrollX;
  const sy = br.top  + br.height/2 + window.scrollY;
  const steps = 14;
  if(trail){
    for(let k=1;k<=steps;k++){
      setTimeout(()=>{
        const px = sx + (x - sx) * (k/steps);
        const py = sy + (y - sy) * (k/steps);
        spawnSpark(px, py);
      }, k*16);
    }
  }
  booha.style.left = x + 'px';
  booha.style.top  = y + 'px';
  shadow.style.left = x + 'px';
  shadow.style.top  = (y + 18) + 'px';
}

function spawnSpark(x,y){
  const s = document.createElement('i');
  s.className = 'spark';
  s.style.left = (x + (Math.random()*12-6)) + 'px';
  s.style.top  = (y + (Math.random()*12-6)) + 'px';
  document.body.appendChild(s);
  setTimeout(()=>s.remove(), 720);
}

// Open modal when clicking the current node
nodes.forEach(n=>{
  n.el.addEventListener('click', ()=>{
    if(n.i > currentIndex) return; // locked
    openWeek(n);
  });
});

function openWeek(n){
  titleEl.textContent = `${MONTHS[n.monthIdx]} — Week ${n.weekIdx}`;
  const qs = `?month=${MONTHS[n.monthIdx].toLowerCase()}&week=${n.weekIdx}`;
  deck1.href = `placeholder.html${qs}&deck=1`;
  deck2.href = `placeholder.html${qs}&deck=2`;
  modal.classList.add('show');

  // When any deck is clicked: mark visited and advance to next index
  const markAndAdvance = () => {
    if(!visited.includes(n.i)) visited.push(n.i);
    localStorage.setItem(LS_VISITED, JSON.stringify(visited));
    if(currentIndex === n.i && currentIndex < nodes.length-1){
      currentIndex++;
      localStorage.setItem(LS_INDEX, String(currentIndex));
    }
    refreshNodeStates();
    // small delay to let the page start
    setTimeout(()=>{
      modal.classList.remove('show');
      moveToCurrent();
    }, 120);
  };
  deck1.onclick = markAndAdvance;
  deck2.onclick = markAndAdvance;
}

function moveToCurrent(){
  const n = nodes[currentIndex] || nodes[0];
  positionBooha(n.x, n.y, true);
}

// Close modal
[backdrop, closeBtn].forEach(el=>el.addEventListener('click',()=>modal.classList.remove('show')));

// Reset
document.getElementById('reset').addEventListener('click', (e)=>{
  e.preventDefault();
  if(confirm('Reset local progress on this device?')){
    currentIndex = 0; visited = [];
    localStorage.setItem(LS_INDEX, '0');
    localStorage.setItem(LS_VISITED, '[]');
    refreshNodeStates();
    placeBoohaAtIndex(0);
  }
});

// Initial placement and state
window.addEventListener('load', ()=>{
  refreshNodeStates();
  placeBoohaAtIndex(currentIndex);
});

// Keep positions aligned on resize
window.addEventListener('resize', ()=>{
  const n = nodes[currentIndex] || nodes[0];
  positionBooha(n.x, n.y, false);
});
</script>
</body>
</html>
