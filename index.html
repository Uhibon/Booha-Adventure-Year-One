<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Maze — Year One (Soft Glow)</title>
<style>
:root{ --zoom:1; --tx:0px; --ty:0px; }
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;overflow:hidden}
/* Foresty edges so maze blends nicely */
body{background:radial-gradient(140% 100% at 50% 0%, #17381f 0%, #112a18 40%, #0c2012 85%, #08160c 100%)}

/* Fullscreen stage */
.viewport{position:relative;width:100vw;height:100vh;overflow:hidden}
.world{position:absolute;left:50%;top:50%;transform:translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(var(--zoom));transform-origin:center;transition:transform .55s cubic-bezier(.22,.65,.2,1)}
#maze{width:100vw;height:100vh;background:url('assets/maze.png') center/contain no-repeat}

/* Booha (expects a transparent PNG) */
#booha{position:absolute;width:68px;height:68px;transform:translate(-50%,-50%);z-index:12;pointer-events:none;image-rendering:auto;filter:drop-shadow(0 0 10px #ffe17a) drop-shadow(0 4px 18px #000a)}
@keyframes bob{0%,100%{transform:translate(-50%,-50%) translateY(0)}50%{transform:translate(-50%,-50%) translateY(-6px)}}
.bobbing{animation:bob 3.2s ease-in-out infinite}

/* Sparkle trail while moving */
.spark{position:absolute;width:6px;height:6px;border-radius:50%;pointer-events:none;background:radial-gradient(circle at 35% 35%, #fff, currentColor 60%, transparent 72%);box-shadow:0 0 10px currentColor;animation:spark .8s ease-out forwards}
@keyframes spark{0%{transform:scale(.85);opacity:1}60%{transform:scale(1.1)}100%{transform:scale(.2) translateY(6px);opacity:0}}

/* Twinkly tree lights around a checkpoint */
.twinkle{position:absolute;width:7px;height:7px;border-radius:50%;pointer-events:none;box-shadow:0 0 10px currentColor, 0 0 18px currentColor}
@keyframes twink{0%,100%{opacity:.25;transform:scale(.8)}50%{opacity:1;transform:scale(1.15)}}

/* Weekly stops: invisible until revealed */
.stop{position:absolute;width:18px;height:18px;border-radius:50%;transform:translate(-50%,-50%);opacity:0;pointer-events:none;z-index:11}
.stop.hidden{opacity:0;transform:translate(-50%,-50%) scale(.6)}
.stop.seen{opacity:1;pointer-events:auto;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.25)}}

/* Zoom vignette (kept, not auto-used) */
.viewport::after{content:"";position:absolute;inset:0;pointer-events:none;opacity:0;transition:opacity .35s ease;background:radial-gradient(120% 120% at 50% 50%, transparent 40%, #000 100%)}
.viewport.zoomed::after{opacity:.55}

/* Modal (kept for future use) */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0008;z-index:120}
.modal.show{display:flex}
.card{background:#101d42;padding:20px;border-radius:16px;width:min(680px,92vw);text-align:center;color:#fff;border:1px solid #ffffff22;box-shadow:0 20px 50px #000a}
.card a{display:inline-block;margin:0 8px;padding:10px 12px;border-radius:12px;border:1px solid #ffffff26;color:#e2e8f0;text-decoration:none;background:#101a39}
.card a:hover{background:#122045}

/* Controls */
.tools{position:fixed;left:12px;bottom:12px;display:flex;gap:8px;z-index:200}
.btn{padding:10px 14px;font-weight:700;border-radius:12px;border:1px solid #ffffff26;background:#203a27;color:#e5edff;cursor:pointer}
.btn:hover{background:#25452f}
</style>
</head>
<body>
<div class="viewport" id="viewport">
  <div class="world" id="world">
    <div id="maze"></div>
  </div>
</div>
<img id="booha" class="bobbing" src="assets/mazebooha.png" alt="booha" />

<!-- Controls -->
<div class="tools">
  <button class="btn" id="test">TEST</button>
  <button class="btn" id="next">Next ▶︎</button>
  <button class="btn" id="reset">Reset</button>
</div>

<!-- Modal (not auto-opened in this version) -->
<div class="modal" id="modal">
  <div class="card">
    <h2 id="title">Month — Week</h2>
    <p>Choose a deck to open.</p>
    <a id="deck1" href="#">Deck 1</a>
    <a id="deck2" href="#">Deck 2</a>
  </div>
</div>

<script>
/* ------------------ CONFIG ------------------ */
const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
const MONTH_COLORS=['#cddfff','#ffb6c1','#ffda8a','#a7f5b1','#7fdfff','#ffe066','#ff9edb','#f8b54c','#d6b3ff','#ff9851','#ffd6a1','#fff4c7'];
const TOTAL=48; // 4 per month

// Your finalized coordinates:
const POS = [{"x":36.94,"y":4.85},{"x":32.14,"y":55.21},{"x":72.12,"y":69.2},{"x":53.92,"y":13.34},{"x":24.14,"y":82.86},{"x":63.67,"y":32.74},{"x":32.22,"y":26.27},{"x":65.27,"y":83.02},{"x":54.38,"y":59.66},{"x":70.22,"y":24.33},{"x":45.39,"y":13.58},{"x":22.77,"y":63.78},{"x":45.62,"y":41.47},{"x":40.14,"y":73.89},{"x":37.55,"y":13.26},{"x":71.67,"y":59.74},{"x":44.71,"y":26.35},{"x":32.22,"y":82.54},{"x":54.15,"y":22.88},{"x":24.68,"y":89.33},{"x":63.59,"y":41.63},{"x":64.51,"y":23.44},{"x":44.33,"y":55.21},{"x":71.21,"y":79.22},{"x":31.91,"y":37.91},{"x":59.1,"y":94.02},{"x":69.54,"y":50.53},{"x":33.28,"y":89.65},{"x":70.98,"y":35.41},{"x":22.92,"y":73.65},{"x":55.67,"y":51.01},{"x":37.32,"y":25.71},{"x":55.98,"y":73.89},{"x":54.91,"y":31.85},{"x":56.21,"y":82.54},{"x":31.68,"y":45.68},{"x":64.36,"y":59.18},{"x":39.22,"y":63.3},{"x":70.91,"y":42.36},{"x":32.75,"y":63.78},{"x":48.97,"y":63.78},{"x":43.03,"y":94.18},{"x":70.75,"y":30.07},{"x":61.08,"y":46.97},{"x":44.33,"y":82.46},{"x":53.47,"y":41.96},{"x":37.32,"y":19.73},{"x":65.73,"y":96.2}];

/* ---------------- Elements ---------------- */
const viewport=document.getElementById('viewport');
const world=document.getElementById('world');
const maze=document.getElementById('maze');
const booha=document.getElementById('booha');
const testBtn=document.getElementById('test');
const nextBtn=document.getElementById('next');
const resetBtn=document.getElementById('reset');
const modal=document.getElementById('modal');
const titleEl=document.getElementById('title');
const deck1=document.getElementById('deck1');
const deck2=document.getElementById('deck2');

/* ---------------- Audio ---------------- */
const bgm = new Audio('audio/sneaky.mp3'); bgm.loop = true;
const sfxCheckpoint = new Audio('audio/checkpoint.mp3');
let audioPrimed = false;
function primeAudio(){ if(audioPrimed) return; audioPrimed=true; bgm.currentTime=0; bgm.play().catch(()=>{}); }

/* --------------- State ---------------- */
let currentIndex=0; // current checkpoint index
let revealed = Array(TOTAL).fill(false);
let moving=false;

/* ------------- Build stops ------------- */
const stops=[];
POS.forEach((p,i)=>{
  const el=document.createElement('div');
  el.className='stop hidden';
  el.style.left=p.x+'%'; el.style.top=p.y+'%';
  world.appendChild(el);
  stops.push({i,x:p.x,y:p.y,el});
});

/* -------------- Helpers --------------- */
function monthColor(i){return MONTH_COLORS[Math.floor(i/4)];}

function styleStop(i){
  const n=stops[i];
  const color=monthColor(i);
  n.el.style.background = `radial-gradient(circle, ${color} 0%, ${color} 60%, ${shade(color,-20)} 100%)`;
  n.el.style.boxShadow = `0 0 0 2px #0008 inset, 0 0 16px ${hexA(color,.65)}, 0 0 34px ${hexA(color,.35)}`;
}

function revealStop(i){
  if(revealed[i]) return; revealed[i]=true; styleStop(i);
  const el=stops[i].el; el.classList.remove('hidden'); el.classList.add('seen');
  burstAt(i);
}

function placeBoohaAt(i, offset=-1){
  const n=stops[i]; const r=maze.getBoundingClientRect();
  const x=r.left+(n.x/100)*r.width + window.scrollX + offset;
  const y=r.top +(n.y/100)*r.height + window.scrollY + offset;
  booha.style.left=x+'px'; booha.style.top=y+'px';
}

/* --------- Movement (slower now) --------- */
function moveBooha(to){
  return new Promise(resolve=>{
    moving=true;
    const from=stops[currentIndex]; const end=stops[to];
    const r=maze.getBoundingClientRect();
    const sx=r.left+(from.x/100)*r.width + window.scrollX;
    const sy=r.top +(from.y/100)*r.height + window.scrollY;
    const ex=r.left+(end.x/100)*r.width + window.scrollX;
    const ey=r.top +(end.y/100)*r.height + window.scrollY;
    const dist=Math.hypot(ex-sx,ey-sy);

    // Slower glide: distance-based with gentle easing
    const dur = Math.max(2000, Math.min(6500, dist * 2.4)); // <- slower than before

    const t0=performance.now();
    function step(t){
      const k=Math.min(1,(t-t0)/dur);
      const e=k<.5?2*k*k:1-Math.pow(-2*k+2,2)/2;
      const x=sx+(ex-sx)*e, y=sy+(ey-sy)*e;
      booha.style.left=x+'px'; booha.style.top=y+'px';
      if(Math.random()<.85) spawnSpark(x,y, monthColor(currentIndex));
      if(k<1) requestAnimationFrame(step); else {moving=false; resolve();}
    }
    requestAnimationFrame(step);
  });
}

/* -------- Visual effects -------- */
function spawnSpark(x,y,color){
  const s=document.createElement('i'); s.className='spark'; s.style.color=color||'#ffd400'; s.style.left=x+'px'; s.style.top=y+'px';
  document.body.appendChild(s); setTimeout(()=>s.remove(),820);
}

function burstAt(i){
  const n=stops[i]; const r=maze.getBoundingClientRect();
  const bx=r.left+(n.x/100)*r.width + window.scrollX; 
  const by=r.top +(n.y/100)*r.height + window.scrollY; 
  const color=monthColor(i);
  for(let k=0;k<12;k++) setTimeout(()=>spawnSpark(bx+(Math.random()*40-20), by+(Math.random()*40-20), color), k*28);
}

/* ----- “Christmas lights” around checkpoint (3–6s) ----- */
function sparkleForest(i){
  const r=maze.getBoundingClientRect();
  const node=stops[i];
  const cx=r.left+(node.x/100)*r.width + window.scrollX;
  const cy=r.top +(node.y/100)*r.height + window.scrollY;
  const color=monthColor(i);

  // How many twinkles and how far they spread from the checkpoint:
  const count = 60;
  const radiusMin = 40;
  const radiusMax = 140;

  const twinkles = [];
  for(let n=0;n<count;n++){
    const tw = document.createElement('i');
    tw.className='twinkle';
    tw.style.color = color;

    // random polar position
    const a = Math.random()*Math.PI*2;
    const rlen = radiusMin + Math.random()*(radiusMax-radiusMin);
    const x = cx + Math.cos(a)*rlen;
    const y = cy + Math.sin(a)*rlen;

    tw.style.left = x+'px';
    tw.style.top  = y+'px';
    const d = 3000 + Math.random()*3000; // 3–6s
    tw.style.animation = `twink ${900 + Math.random()*900}ms ease-in-out ${Math.random()*300}ms infinite`;
    tw.dataset.expire = (performance.now()+d).toString();
    document.body.appendChild(tw);
    twinkles.push(tw);
  }

  // cleanup after max lifetime
  const killAt = performance.now()+6100;
  function clean(){
    const now = performance.now();
    twinkles.forEach(t=>{
      if(!t) return;
      if(now > Number(t.dataset.expire)){
        t.style.transition='opacity .35s ease'; t.style.opacity='0';
        setTimeout(()=>t.remove(), 380);
      }
    });
    if(now < killAt) requestAnimationFrame(clean);
  }
  requestAnimationFrame(clean);
}

/* ---------- Zoom helpers (optional) ---------- */
function zoomTo(i){
  const n=stops[i]; const zoom=1.25; const rect=maze.getBoundingClientRect();
  const cx=(n.x/100)*rect.width - rect.width/2; const cy=(n.y/100)*rect.height - rect.height/2;
  document.documentElement.style.setProperty('--zoom', zoom);
  document.documentElement.style.setProperty('--tx', (-cx*(zoom-1)/zoom)+'px');
  document.documentElement.style.setProperty('--ty', (-cy*(zoom-1)/zoom)+'px');
  viewport.classList.add('zoomed');
}
function zoomReset(){ document.documentElement.style.setProperty('--zoom',1); document.documentElement.style.setProperty('--tx','0px'); document.documentElement.style.setProperty('--ty','0px'); viewport.classList.remove('zoomed'); }

/* -------- Arrival behavior -------- */
async function arriveAt(i){
  revealStop(i);
  sfxCheckpoint.currentTime = 0; sfxCheckpoint.play().catch(()=>{});
  sparkleForest(i);                 // twinkly trees around checkpoint
  // Optional zoom peek (kept subtle and short):
  zoomTo(i); setTimeout(zoomReset, 700);
}

/* ---------------- Controls ---------------- */
resetBtn.addEventListener('click',()=>{
  primeAudio();
  currentIndex=0; 
  revealed=Array(TOTAL).fill(false); 
  document.querySelectorAll('.stop').forEach(s=>s.className='stop hidden'); 
  placeBoohaAt(0,-12); 
  zoomReset();
});

testBtn.addEventListener('click',()=>{
  primeAudio();
  // Reset and show first checkpoint only
  currentIndex=0; 
  revealed=Array(TOTAL).fill(false);
  document.querySelectorAll('.stop').forEach(s=>s.className='stop hidden');
  placeBoohaAt(0,-12);
  arriveAt(0);
});

nextBtn.addEventListener('click', async ()=>{
  primeAudio();
  if(moving) return;
  let next = currentIndex + 1;
  if(next >= TOTAL) next = 0; // wrap-around
  await moveBooha(next);
  currentIndex = next;
  await arriveAt(currentIndex);
});

/* --------------- Init ---------------- */
placeBoohaAt(0,-12);
window.addEventListener('resize',()=>placeBoohaAt(currentIndex,-12));

/* ---------------- Utils ---------------- */
function hexA(hex,a){const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return `rgba(${r},${g},${b},${a})`;}
function shade(hex,p){const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);const f=v=>Math.max(0,Math.min(255,Math.round(v*(100+p)/100)));return `#${f(r).toString(16).padStart(2,'0')}${f(g).toString(16).padStart(2,'0')}${f(b).toString(16).padStart(2,'0')}`;}
</script>
</body>
</html>
