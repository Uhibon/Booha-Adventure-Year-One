<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Maze — Year One (Deluxe 5)</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{--zoom:1;--tx:0px;--ty:0px;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;overflow:hidden;background:#0b1c11;font-family:system-ui,"Noto Sans JP",sans-serif}
.viewport{position:relative;width:100vw;height:100vh;overflow:hidden}
.world{position:absolute;left:50%;top:50%;transform:translate(calc(-50% + var(--tx)),calc(-50% + var(--ty))) scale(var(--zoom));transform-origin:center;transition:transform .65s cubic-bezier(.22,.65,.2,1)}
#maze{width:100vw;height:100vh;background:url('assets/maze.png') center/contain no-repeat}

/* Booha */
#booha{position:absolute;width:68px;height:68px;transform:translate(-50%,-50%) scale(1);z-index:12;pointer-events:none;opacity:0;filter:drop-shadow(0 0 10px #ffe17a) drop-shadow(0 4px 18px #000a);}
@keyframes bob{0%,100%{transform:translate(-50%,-50%) translateY(0)}50%{transform:translate(-50%,-50%) translateY(-6px)}}
.bobbing{animation:bob 3.6s ease-in-out infinite}

/* Poof smoke */
.smoke{position:absolute;width:160px;height:160px;left:0;top:0;transform:translate(-50%,-50%) scale(.5);pointer-events:none;z-index:10;
background:radial-gradient(circle at 50% 50%,rgba(255,255,255,.9)0%,rgba(255,255,255,.5)30%,rgba(255,255,255,0)70%);
animation:poof 1.2s ease-out forwards;}
@keyframes poof{0%{opacity:1;transform:translate(-50%,-50%) scale(.5);}60%{opacity:.6;transform:translate(-50%,-50%) scale(2);}100%{opacity:0;transform:translate(-50%,-50%) scale(3);}}

/* Gold glitter trail (bigger) */
.spark{position:absolute;width:4.4px;height:4.4px;border-radius:50%;pointer-events:none;
background:radial-gradient(circle at 40% 40%,#fff,#ffd86d 60%,transparent 80%);
box-shadow:0 0 6px #fff6cc,0 0 12px #ffd86d,0 0 20px #ffec9c;opacity:.97;
animation:spark 1s ease-out forwards;}
@keyframes spark{
0%{transform:translate(0,0) scale(1);opacity:1}
50%{opacity:.9}
100%{transform:translate(0,12px) scale(.7);opacity:0}
}

/* Fairy glitter sparkle */
.fairy{position:absolute;width:5px;height:5px;border-radius:50%;pointer-events:none;
background:radial-gradient(circle,#fff 0%,currentColor 60%,transparent 80%);
box-shadow:0 0 8px currentColor,0 0 20px currentColor,0 0 32px currentColor;
opacity:.9;animation:drift var(--dur,5200ms) cubic-bezier(.2,.7,.1,1) forwards,twinkle 0.8s infinite alternate;
z-index:20;}
@keyframes drift{0%{transform:translate(-50%,-50%) scale(.9)}100%{transform:translate(calc(-50% + var(--dx)),calc(-50% + var(--dy))) scale(1.1);opacity:0}}
@keyframes twinkle{0%{filter:brightness(1)}100%{filter:brightness(1.6)}}

.stop{position:absolute;width:18px;height:18px;border-radius:50%;transform:translate(-50%,-50%);opacity:0;pointer-events:none;z-index:11}
.stop.hidden{opacity:0;transform:translate(-50%,-50%) scale(.6)}
.stop.seen{opacity:1;pointer-events:auto;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.25)}}

.tools{position:fixed;left:12px;bottom:12px;display:flex;gap:8px;z-index:200}
.btn{padding:10px 14px;font-weight:700;border-radius:12px;border:1px solid #ffffff26;background:#203a27;color:#e5edff;cursor:pointer}
.btn:hover{background:#25452f}
</style>
</head>
<body>
<div class="viewport" id="viewport"><div class="world" id="world"><div id="maze"></div></div></div>
<img id="booha" src="assets/mazebooha.png" alt="booha"/>

<div class="tools">
 <button class="btn" id="test">TEST</button>
 <button class="btn" id="next">Next ▶︎</button>
 <button class="btn" id="reset">Reset</button>
</div>

<script>
const POS=[{"x":36.94,"y":4.85},{"x":32.14,"y":55.21},{"x":72.12,"y":69.2},{"x":53.92,"y":13.34},{"x":24.14,"y":82.86},{"x":63.67,"y":32.74},{"x":32.22,"y":26.27},{"x":65.27,"y":83.02},{"x":54.38,"y":59.66},{"x":70.22,"y":24.33},{"x":45.39,"y":13.58},{"x":22.77,"y":63.78},{"x":45.62,"y":41.47},{"x":40.14,"y":73.89},{"x":37.55,"y":13.26},{"x":71.67,"y":59.74},{"x":44.71,"y":26.35},{"x":32.22,"y":82.54},{"x":54.15,"y":22.88},{"x":24.68,"y":89.33},{"x":63.59,"y":41.63},{"x":64.51,"y":23.44},{"x":44.33,"y":55.21},{"x":71.21,"y":79.22},{"x":31.91,"y":37.91},{"x":59.1,"y":94.02},{"x":69.54,"y":50.53},{"x":33.28,"y":89.65},{"x":70.98,"y":35.41},{"x":22.92,"y":73.65},{"x":55.67,"y":51.01},{"x":37.32,"y":25.71},{"x":55.98,"y":73.89},{"x":54.91,"y":31.85},{"x":56.21,"y":82.54},{"x":31.68,"y":45.68},{"x":64.36,"y":59.18},{"x":39.22,"y":63.3},{"x":70.91,"y":42.36},{"x":32.75,"y":63.78},{"x":48.97,"y":63.78},{"x":43.03,"y":94.18},{"x":70.75,"y":30.07},{"x":61.08,"y":46.97},{"x":44.33,"y":82.46},{"x":53.47,"y":41.96},{"x":37.32,"y":19.73},{"x":65.73,"y":96.2}];

const maze=document.getElementById('maze');
const booha=document.getElementById('booha');
const testBtn=document.getElementById('test');
const nextBtn=document.getElementById('next');
const resetBtn=document.getElementById('reset');

const bgm=new Audio('audio/sneaky.mp3');bgm.loop=true;
const sfxCheckpoint=new Audio('audio/checkpoint.mp3');
let audioPrimed=false;
function primeAudio(){if(audioPrimed)return;audioPrimed=true;bgm.currentTime=0;bgm.play().catch(()=>{});}

let currentIndex=-1;let moving=false;

function placeBoohaXY(x,y){booha.style.left=x+'px';booha.style.top=y+'px';}
function startPosition(){
 const r=maze.getBoundingClientRect();
 return{
  x:r.left+window.scrollX+r.width*0.065,
  y:r.top+window.scrollY+r.height*0.085
 };
}
function easeInOutCubic(t){return t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;}
function stopPx(i,rect){const n=POS[i];return{x:rect.left+(n.x/100)*rect.width+window.scrollX,y:rect.top+(n.y/100)*rect.height+window.scrollY};}
function spawnSpark(x,y){
 const s=document.createElement('i');s.className='spark';s.style.left=x+'px';s.style.top=y+'px';
 document.body.appendChild(s);setTimeout(()=>s.remove(),1000);
}
function fairyBurst(i){
 const rect=maze.getBoundingClientRect();
 const {x:cx,y:cy}=stopPx(i,rect);
 const count=200,radiusMin=40,radiusMax=260;
 for(let n=0;n<count;n++){
  const a=Math.random()*Math.PI*2;
  const len=radiusMin+Math.pow(Math.random(),.5)*(radiusMax-radiusMin);
  const dx=Math.cos(a)*len,dy=Math.sin(a)*len;
  const tw=document.createElement('i');tw.className='fairy';
  tw.style.color=`hsl(${Math.random()*60+40},100%,75%)`;
  tw.style.left=cx+'px';tw.style.top=cy+'px';
  tw.style.setProperty('--dx',dx+'px');
  tw.style.setProperty('--dy',dy+'px');
  tw.style.setProperty('--dur',(4000+Math.random()*3500)+'ms');
  tw.style.animationDelay=(Math.random()*200)+'ms';
  document.body.appendChild(tw);
  setTimeout(()=>tw.remove(),7800);
 }
}
function moveBoohaToXY(ex,ey){
 return new Promise(resolve=>{
  moving=true;
  const rect=maze.getBoundingClientRect();
  const sx=parseFloat(booha.style.left)|| (rect.left+window.scrollX);
  const sy=parseFloat(booha.style.top)|| (rect.top +window.scrollY);
  const dx=ex-sx,dy=ey-sy;
  const dist=Math.hypot(dx,dy);
  const dur=Math.max(5200,Math.min(14000,dist*6.5));
  const t0=performance.now();
  function step(t){
   const k=Math.min(1,(t-t0)/dur);
   const e=easeInOutCubic(k);
   const x=sx+dx*e,y=sy+dy*e;
   placeBoohaXY(x,y);
   for(let n=0;n<2;n++){if(Math.random()<.9)spawnSpark(x+(Math.random()*4-2),y+(Math.random()*4-2));}
   if(k<1)requestAnimationFrame(step);
   else{placeBoohaXY(ex,ey);moving=false;resolve();}
  }
  requestAnimationFrame(step);
 });
}
function moveBooha(i){
 const rect=maze.getBoundingClientRect();
 const {x,y}=stopPx(i,rect);
 return moveBoohaToXY(x,y);
}
async function playCheckpoint(){
 try{
   sfxCheckpoint.currentTime=0;
   await sfxCheckpoint.play();
 }catch(e){}
 await new Promise(r=>setTimeout(r,4000));
}
async function arriveAt(i){
 await playCheckpoint();
 fairyBurst(i);
}
async function goNext(){
 primeAudio();if(moving)return;
 let next=currentIndex+1;if(next>=POS.length)next=0;
 await moveBooha(next);currentIndex=next;await arriveAt(currentIndex);
}
function poofAtStart(){
 const pos=startPosition();
 const smoke=document.createElement('div');smoke.className='smoke';smoke.style.left=pos.x+'px';smoke.style.top=pos.y+'px';
 document.body.appendChild(smoke);
 setTimeout(()=>smoke.remove(),1200);
 booha.style.left=pos.x+'px';booha.style.top=pos.y+'px';
 setTimeout(()=>{booha.style.opacity=1;booha.classList.add('bobbing');},400);
}
testBtn.onclick=()=>{
 primeAudio();currentIndex=-1;
 booha.style.opacity=0;poofAtStart();
 setTimeout(()=>goNext(),1300);
};
nextBtn.onclick=goNext;
resetBtn.onclick=()=>{currentIndex=-1;booha.style.opacity=0;}
window.onload=()=>{const pos=startPosition();placeBoohaXY(pos.x,pos.y);}
</script>
</body>
</html>
